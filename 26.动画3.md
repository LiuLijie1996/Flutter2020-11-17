## 动画切换组件

```
实际开发中，我们经常会遇到切换UI元素的场景，为了增强用户体验，通常在切换时都会指定一个动画，以使切换过程显得平滑，FLutter SDK组件库中已经提供了一些常用的切换组件，如 PageView、TabView等，但是，这些组件并不能覆盖全部的需求场景，为此框架还提供了一个通用UI切换组件AnimatedSwitcher。
```



## AnimatedSwitcher

```dart
// AnimatedSwitcher 可以同时对其新、旧子元素添加显示、隐藏动画。也就是说在AnimatedSwitcher的子元素发生变化时，会对其旧元素和新元素进行切换。
// child发生变化时（类型或Key不同），旧child会执行隐藏动画，新child会执行显示动画。

const AnimatedSwitcher({
    Key key,
    this.child,
    @required this.duration,//新child显示动画时长
    this.reverseDuration,//旧child隐藏的动画时长
    this.switchInCurve = Curves.linear,//新child显示的动画曲线
    this.switchOutCurve = Curves.linear,//旧child隐藏的动画曲线
    this.transitionBuilder = AnimatedSwitcher.defaultTransitionBuilder,//动画构建器
    this.layoutBuilder = AnimatedSwitcher.defaultLayoutBuilder,//布局构建器
});


/*
	transitionBuilder 参数决定动画效果, 参数类型为：AnimatedSwitcherTransitionBuilder
	
    分别对新、旧child绑定动画，旧child反向执行，新child正向执行。
    transitionBuilder 默认值是 AnimatedSwitcher.defaultTransitionBuilder。
*/
```

```dart
class _MyHomeState extends State<MyHome> {
  int _count = 0;

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text("动画组件"),
      ),
      body: Container(
        alignment: Alignment.center,
        child: Column(
          children: [
            AnimatedSwitcher(
              duration: Duration(milliseconds: 500), //显示时间
              reverseDuration: Duration(milliseconds: 1000), //消失时间
              transitionBuilder: (child, animation) {
                // ScaleTransition 显示时放大组件，消失时缩小组件
                return ScaleTransition(
                  scale: animation,
                  child: child,
                );
              },
              child: Text(
                "$_count",
                key: Key("$_count"),
                style: TextStyle(fontSize: 50.0),
              ),
            ),
            RaisedButton(
              onPressed: () {
                setState(() {
                  _count++;
                });
              },
              child: Text("点击+1"),
            )
          ],
        ),
      ),
    );
  }
}
```



### 实现原理

```
AnimatedSwitcher 实现原理：
	当child发生变化时，则重新执行build，然后动画开始执行。
	didUpdateWidget 回调中判断其新旧child是否发生变化，如果发生变化，则对旧child执行反向退场（reverse）动画，对新child执行正向（forward）入场动画即可。
```



## 动画过渡组件

```
在Widget属性发生变化时会执行过渡动画的组件统称为“动画过渡组件”，而动画过渡组件最明显的一个特征就是他会在内部自管理AnimationController.
在前面介绍过的动画封装方法中，通常都需要使用者自己提供一个AnimationController对象来自定义这些属性值，但是就必须得手动管理AnimationController，这又会增加使用的复杂性，因此，如果也能将AnimationController进行封装，则会大大提高动画组件的易用性。
```

