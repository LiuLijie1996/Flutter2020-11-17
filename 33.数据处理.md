## JSON解析简介

```
在项目开发中，后台接口往往会返回一些结构化的数据，目前最流行的就是JSON，为了方便我们在代码中操作JSON，我们需要先将JSON格式的字符串转为Dart对象。

dart:convert 包中内置了JSON解码器json.decode
decode方法会根据JSON字符串具体内容将其解析为List或者Map
json.decode解码方式比较简单，没有外部依赖或其他设置，对于小项目很方便
项目复杂的情况，手动编写序列化逻辑可能将变得难以管理。
```

### 示例

```dart
String str1 = '{"name":"小明", "email":"123456@qq.com"}';
Map map1 = json.decode(str1);
print(map1['name']);// 小明

String str2 = '[{"name":"小明", "email":"123456@qq.com"}]';
List map2 = json.decode(str2);
print(map2[0]['name']);// 小明
```



### JSON转Dart Model

```
通过预定义一些与Json结构对应的Model类，然后在请求到数据后再动态根据数据创建出Model类的实例。
fromJson 构造函数，用于从一个map构造出一个实例；
toJson方法，用于将一个实例转换成一个map
```

#### 方法一

```dart
// 手写一个 User 类
class User {
  final String name;
  final String email;

  User({this.name, this.email});

  User.fromJson(Map<String, dynamic> map)
      : name = map['name'],
        email = map['email'];

  Map<String, dynamic> toJson() {
    return <String, dynamic>{
      "name": name,
      "email": email,
    };
  }
}



String str1 = '{"name":"小明", "email":"123456@qq.com"}';
Map map3 = json.decode(str1);

// 进行转换
User user = User.fromJson(map3);//传入json数据进行转换
print(user.name);// 小明

// 转换成 Map  方法1
Map userMap = user.toJson();
print(userMap['name']);

// 转换成 Map  方法2
String userString = json.encode(user);
Map userMap2 = json.decode(userString);
print(userMap2);
```



#### 方法二：快速生成 model 类

```
在实际场景中，可能会遇到复杂嵌套的JSON对象，常用快速生成model类的方式：
	以 json_to_dart 方式创建 model 类 https://javiercbk.github.io/json_to_dart
	以 json_serializable（第三方包） 方式创建 model 类
```



方法三：以 json_serializable（第三方包） 方式创建 model 类

```dart
/*
	使用以下三个包：
		json_annotation: ^3.1.1   （放在dependencies下）
		json_serializable: ^3.5.1   （放在dev_dependencies下）
  		build_runner: ^1.10.9   （放在dev_dependencies下）
*/

// 在model文件夹下 创建一个 Info 生成器
// 然后运行指令：flutter packages pub run build_runner build

import 'package:json_annotation/json_annotation.dart';
part 'info.g.dart';

// @JsonSerializable() 告诉生成器，这个类是需要生成model类的
@JsonSerializable()
class Info {
  Info(this.name, this.email);

  final String name;
  final String email;

  // 去写两个方法的模板
  factory Info.fromJson(Map<String, dynamic> map) {
    return _$InfoFromJson(map);
  }

  Map<String, dynamic> toJson() {
    return _$InfoToJson(this);
  }
}
```







## SharedPreferences

```
文件比较适合大量的、有序的数据持久化，如果我们只是需要缓存少量的键值对信息，则可以使用SharedPreferences。它以原生平台相关的机制，为简单的键值对数据提供持久化存储，即在IOS上使用NSUserDefaults，在Android使用SharedPreferences

键值对存储：
	setter方法会同步更新内存中的键值对，并将数据保存至磁盘。
	getter方法用于读取文件中的数据。
	以键值对方式只能保存基本类型的数据：int、double、bool和String。
```



## 数据库存储

```dart
准备存储对象：
	Model类拥有一个可以将JSON字典转换成类对象的工厂类方法，我们也可以提供将类对象反过来转换成JSON字典的实例方法。因为最终存入数据库的并不是实体类对象，而是字符串、整型等基本类型组成的字典。
```

### 创建数据库

```
通过openDatabase函数，给定了以恶搞数据库存储地址，并通过数据库表初始化语句，创建了一个用于存放Student对象的student表。
```

